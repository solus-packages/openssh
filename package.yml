name       : openssh
version    : 7.7_p1
release    : 25
source     :
    - https://ftp.openbsd.org/pub/OpenBSD/OpenSSH/portable/openssh-7.7p1.tar.gz : d73be7e684e99efcd024be15a30bffcbe41b012b2f7b3c9084aed621775e6b8f
homepage   : https://www.openssh.com/
license    :
    - BSD-2-Clause
    - BSD-3-Clause
    - ISC
    - MIT
summary    :
    - OpenSSH (OpenBSD Secure Shell)
    - server : OpenSSH Daemon
description: |
    OpenSSH is a free version of secure shell tools developed by the OpenBSD project to help facilitate secure connections and communications.
component  :
    - network.clients
    - server : network.clients
builddeps  :
    - xauth
    - kerberos-devel
    - e2fsprogs-devel
rundeps    :
    - server :
        - openssh
        - xauth
patterns   :
    - server :
        - /usr/sbin
        - /usr/lib/systemd/system
        - /usr/lib/sysusers.d
        - /usr/lib/tmpfiles.d
        - /etc/ssh/sshd_config
        - /usr/lib64/openssh/sftp*
        - /usr/share/man/*/sshd*
        - /usr/share/man/*/sftp-*
setup      : |
    %patch -p3 < $pkgfiles/security/cve-2018-15473.patch
    %configure --sysconfdir=/etc/ssh \
               --datadir=/usr/share/sshd \
               --with-xauth=/usr/bin/xauth \
               --with-kerberos5=/usr \
               --with-md5-passwords \
               --with-pam \
               --with-ssl-engine \
               --with-privsep-path=/var/lib/sshd
build      : |
    %make
install    : |
    %make_install

    # Make PAM + systemd work
    install -D -m 00644 $pkgfiles/sshd.pam $installdir/etc/pam.d/sshd
    install -D -m 00644 $pkgfiles/sshd.service $installdir/usr/lib/systemd/system/sshd.service
    install -m 00644 $pkgfiles/sshd@.service $installdir/usr/lib/systemd/system/sshd@.service

    # Folks want ssh-copy-id :)
    install -m 00755 contrib/ssh-copy-id $installdir/usr/bin/.

    install -D -m 00644 $pkgfiles/openssh.tmpfiles $installdir/usr/lib/tmpfiles.d/openssh.conf
    install -D -m 00644 $pkgfiles/openssh.sysusers $installdir/usr/lib/sysusers.d/openssh.conf

    rm -rf $installdir/var
