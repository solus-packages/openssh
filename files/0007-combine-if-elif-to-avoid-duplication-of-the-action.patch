From fd360174596047b52aa1cddda74d85012a03ca4b Mon Sep 17 00:00:00 2001
From: Philip Hands <phil@hands.com>
Date: Sat, 3 Oct 2020 23:15:16 +0200
Subject: [PATCH 7/8] combine if/elif to avoid duplication of the action

SSH-Copy-ID-Upstream: 42aeb1cc53d3f7f6e78edc210fb121fda0834914
---
 contrib/ssh-copy-id | 9 +++++----
 1 file changed, 5 insertions(+), 4 deletions(-)

diff --git a/contrib/ssh-copy-id b/contrib/ssh-copy-id
index 6cea9935..1870aed5 100644
--- a/contrib/ssh-copy-id
+++ b/contrib/ssh-copy-id
@@ -201,10 +201,11 @@ populate_new_ids() {
             -o LogLevel=INFO \
             -o PreferredAuthentications=publickey \
             -o IdentitiesOnly=yes "$@" exit >"$L_OUTPUT_FILE" 2>&1 </dev/null
-        if [ "$?" = "$L_SUCCESS" ] ; then
-          : > "$L_TMP_ID_FILE"
-        elif [ "$SFTP" ] && grep 'allows sftp connections only' "$L_OUTPUT_FILE" >/dev/null ; then
-          # this error counts as a success when we're setting up an sftp connection
+        if [ "$?" = "$L_SUCCESS" ] || {
+             [ "$SFTP" ] && grep 'allows sftp connections only' "$L_OUTPUT_FILE" >/dev/null
+             # this error counts as a success if we're setting up an sftp connection
+           }
+        then
           : > "$L_TMP_ID_FILE"
         else
           grep 'Permission denied' "$L_OUTPUT_FILE" >/dev/null || {
-- 
2.28.0

